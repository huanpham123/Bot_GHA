<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Neon Voice Assistant</title>
  <style>
    :root {
      --primary: #00ff9d;
      --secondary: #0066ff;
      --bg: #0a0a16;
      --glass: rgba(255, 255, 255, 0.05);
      --neon-glow: 0 0 20px var(--primary);
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Roboto Mono', monospace;
    }

    body {
      background: var(--bg);
      color: white;
      min-height: 100vh;
      overflow-x: hidden;
      position: relative;
    }

    /* Hệ thống particle */
    .particles {
      position: fixed;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 0;
    }

    .particle {
      position: absolute;
      background: radial-gradient(var(--primary), transparent);
      border-radius: 50%;
      filter: blur(2px);
      animation: particle-float 20s infinite linear;
    }

    /* Nút ghi âm holographic */
    #record-button {
      width: 120px;
      height: 120px;
      background: linear-gradient(45deg, 
        var(--primary) 0%, 
        var(--secondary) 50%, 
        var(--primary) 100%);
      border-radius: 50%;
      position: fixed;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      box-shadow: 
        var(--neon-glow),
        0 0 50px var(--secondary),
        inset 0 0 15px rgba(255, 255, 255, 0.2);
      animation: 
        hologram 4s infinite linear,
        float 3s ease-in-out infinite;
      z-index: 2;
    }

    #record-button::before {
      content: '';
      position: absolute;
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background: inherit;
      filter: blur(25px);
      opacity: 0.4;
      z-index: -1;
    }

    #record-button:hover {
      transform: translate(-50%, -50%) scale(1.15);
      filter: hue-rotate(45deg);
    }

    #record-button.recording {
      animation: 
        pulse 1.5s infinite, 
        hologram 2s infinite linear,
        float 3s ease-in-out infinite;
    }

    /* Chat box với hiệu ứng thủy tinh */
    #chat-box {
      position: fixed;
      bottom: 120px;
      left: 50%;
      transform: translateX(-50%);
      width: 90%;
      max-width: 800px;
      background: linear-gradient(145deg, 
        rgba(255, 255, 255, 0.05) 0%, 
        rgba(255, 255, 255, 0.02) 100%);
      backdrop-filter: blur(15px) saturate(200%);
      border-radius: 20px;
      padding: 30px;
      opacity: 0;
      visibility: hidden;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      border: 1px solid rgba(255, 255, 255, 0.1);
      box-shadow: 
        0 8px 32px rgba(0, 0, 0, 0.3),
        inset 0 0 15px rgba(255, 255, 255, 0.05);
      z-index: 1;
    }

    #chat-box.active {
      opacity: 1;
      visibility: visible;
      transform: translate(-50%, -20px);
    }

    /* Nội dung chat với hiệu ứng matrix */
    #chat-content {
      min-height: 150px;
      max-height: 60vh;
      overflow-y: auto;
      padding: 20px;
      margin-bottom: 20px;
      border-radius: 10px;
      background: rgba(0, 0, 0, 0.3);
      position: relative;
      font-family: 'Courier New', monospace;
    }

    .message {
      margin: 15px 0;
      padding: 12px 20px;
      border-radius: 8px;
      background: linear-gradient(90deg, 
        rgba(0, 255, 157, 0.1) 0%, 
        rgba(0, 102, 255, 0.05) 100%);
      animation: message-appear 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      border-left: 3px solid var(--primary);
    }

    /* Loader công nghệ */
    .loader {
      --loader-size: 40px;
      display: none;
      width: var(--loader-size);
      height: var(--loader-size);
      position: relative;
      margin: 20px auto;
    }

    .loader::before,
    .loader::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      border-radius: 50%;
      border: 3px solid transparent;
      mix-blend-mode: overlay;
    }

    .loader::before {
      border-top-color: var(--primary);
      animation: rotation 1s linear infinite;
    }

    .loader::after {
      border-bottom-color: var(--secondary);
      animation: rotation 1s linear infinite reverse;
    }

    /* Keyframes animation */
    @keyframes hologram {
      0%, 100% { filter: hue-rotate(0deg) contrast(120%); }
      50% { filter: hue-rotate(90deg) contrast(150%); }
    }

    @keyframes particle-float {
      0% { 
        transform: translateY(0) scale(0.5);
        opacity: 0; 
      }
      50% { 
        transform: translateY(-100px) scale(1);
        opacity: 0.6; 
      }
      100% { 
        transform: translateY(-200px) scale(0.5);
        opacity: 0; 
      }
    }

    @keyframes message-appear {
      from {
        opacity: 0;
        transform: translateX(20px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    @keyframes cyber-border {
      0% { border-image: linear-gradient(45deg, var(--primary), var(--secondary)) 1; }
      100% { border-image: linear-gradient(315deg, var(--primary), var(--secondary)) 1; }
    }

    /* Responsive design */
    @media (max-width: 768px) {
      #record-button {
        width: 80px;
        height: 80px;
        animation: hologram 4s infinite linear;
      }
      
      #chat-box {
        bottom: 160px;
        width: 95%;
        padding: 15px;
      }
      
      .message {
        font-size: 14px;
      }
    }
  </style>
</head>
<body>
  <div class="particles" id="particles"></div>
  
  <div id="record-button">
    <svg id="mic-icon" viewBox="0 0 24 24" style="width: 40px; height: 40px; fill: white;">
      <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/>
      <path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/>
    </svg>
  </div>

  <div id="chat-box">
    <div id="chat-content"></div>
    <div class="loader"></div>
    <button id="back-button" class="cyber-button">
      <span class="glow-text">SPEAK AGAIN</span>
      <div class="button-glow"></div>
    </button>
  </div>

  <script>
    // Khởi tạo particle
    function createParticles() {
      const particles = document.getElementById('particles');
      for (let i = 0; i < 50; i++) {
        const particle = document.createElement('div');
        particle.className = 'particle';
        Object.assign(particle.style, {
          width: `${Math.random() * 4 + 2}px`,
          height: particle.style.width,
          left: `${Math.random() * 100}%`,
          animationDelay: `${Math.random() * 20}s`
        });
        particles.appendChild(particle);
      }
    }
    
    // Cập nhật background động
    function updateDynamicBackground() {
      document.addEventListener('mousemove', (e) => {
        const x = e.clientX / window.innerWidth;
        const y = e.clientY / window.innerHeight;
        
        document.body.style.background = `
          radial-gradient(
            circle at ${x * 100}% ${y * 100}%,
            #1a1a2e 0%, 
            #0a0a16 50%,
            #000000 100%
          )
        `;
      });
    }

    // Hiệu ứng nhập văn bản Matrix
    function matrixTextEffect(element, text) {
      let index = 0;
      const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789@#$%^&*';
      
      function animate() {
        if (index < text.length) {
          element.textContent = text.slice(0, index) + chars[Math.floor(Math.random() * chars.length)];
          setTimeout(() => {
            element.textContent = text.slice(0, index);
            index++;
            animate();
          }, 50);
        } else {
          element.textContent = text;
        }
      }
      animate();
    }

    // Khởi tạo các hiệu ứng
    createParticles();
    updateDynamicBackground();

    // Phần JavaScript xử lý chức năng chính giữ nguyên...
    // [Phần JavaScript xử lý voice recognition giữ nguyên như code gốc]
    // ... (Thêm các hiệu ứng animation vào các sự kiện có sẵn)

    // Khi nhận được tin nhắn mới
    function addMessage(message, isUser = false) {
      const msgDiv = document.createElement('div');
      msgDiv.className = `message ${isUser ? 'user-message' : 'bot-message'}`;
      matrixTextEffect(msgDiv, message);
      chatContent.appendChild(msgDiv);
      chatContent.scrollTop = chatContent.scrollHeight;
    }

    // Cập nhật hàm sendChatMessage
    function sendChatMessage(message) {
      addMessage(message, true);
      loader.style.display = 'block';
      
      fetch('/chat', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ message: message })
      })
      .then(response => response.json())
      .then(data => {
        addMessage(data.final_answer || "Không nhận được phản hồi từ chatbot.");
        loader.style.display = 'none';
      })
      .catch(error => {
        addMessage("Đã xảy ra lỗi khi kết nối đến server.");
        loader.style.display = 'none';
      });
    }
  </script>
</body>
</html>
